---
title: –ù–µ–æ–±—ã—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Fork API
description: –ö–∞–∫ –µ—â–µ –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å Fork API –µ—Å–ª–∏ –Ω–µ SSR –∏–ª–∏ —Ç–µ—Å—Ç—ã?
date: 2022-09-18
layout: ../../layouts/MarkdownLayout.astro
---

# Table of Contents

# –í–≤–µ–¥–µ–Ω–∏–µ

–ö–æ–≥–¥–∞ –∑–∞—Ö–æ–¥–∏—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä –æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ fork API, –æ–±—ã—á–Ω–æ –≤—Å–ø–æ–º–∏–Ω–∞—é—Ç —Å–µ—Ä–≤–µ—Ä–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏. –í —ç—Ç–æ–º
—Ä–∞—Å—Å–∫–∞–∑–µ —Å–ø–µ—à—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –∏ –ø–æ–∫–∞–∑–∞—Ç—å –±–æ–ª–µ–µ —à–∏—Ä–æ–∫–∏–π —Å–ø–µ–∫—Ç—Ä –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–π —ç—Ç–æ–≥–æ API.

# –î–∞ –∫—Ç–æ —Ç–∞–∫–æ–π —ç—Ç–æ—Ç –≤–∞—à Fork API üî®

## –ü—Ä–æ–±–ª–µ–º–∞

[effector]: https://effector.dev

–û–±—ã—á–Ω–æ [effector][effector] —Ö—Ä–∞–Ω–∏—Ç –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç–æ—Ä–æ–≤ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤–Ω—É—Ç—Ä–∏ –æ–±—ä–µ–∫—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `createStore`. –•—É–∫–∏
React –∏–ª–∏ SolidJS –≤—ã—Ç–∞—Å–∫–∏–≤–∞—é—Ç
–∑–Ω–∞—á–µ–Ω–∏–µ [–Ω–∞–ø—Ä—è–º—É—é –∏–∑ —ç—Ç–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞](https://github.com/effector/effector/blob/88d721a0a0279109e4a45ba79568b5197152b080/src/react/apiBase.ts#L10)
–ø–æ —Å—Å—ã–ª–∫–µ.

```tsx
const $name = createStore('Sergey Sova');

function Component() {
  const name = useStore($name);
  return <div>Name: {name}</div>;
}
```

–í —Å–ª—É—á–∞–µ —Å SSR, –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –º–æ–≥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ —Å–µ—Ä–≤–µ—Ä—É –Ω—É–∂–Ω–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–¥–∞–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –ö–∞–∫ –º—ã –ø–æ–º–Ω–∏–º Node.JS/Deno/Bun ‚Äî –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω–∞—è —Å—Ä–µ–¥–∞, –Ω–æ –∑–∞ —Å—á–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏ —É–¥–∞–µ—Ç—Å—è –¥–æ–±–∏—Ç—å—Å—è —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ–º–æ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è. –ü–æ–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–µ–Ω—Ç–∞ –ê –∂–¥–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ HTTP-–∑–∞–ø—Ä–æ—Å–∞, —Å–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å –∫–ª–∏–µ–Ω—Ç–æ–≤ –ë –∏–ª–∏ –í.

–ú—ã –Ω–µ –º–æ–∂–µ–º –ø–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –ª–æ–≥–∏–∫–∏, –≤–µ–¥—å [—ç—Ñ—Ñ–µ–∫—Ç—ã](https://effector.dev/ru/docs/api/effector/effect) –±—É–∫–≤–∞–ª—å–Ω–æ —è–≤–ª—è—é—Ç—Å—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏. –î–æ–≤–æ–ª—å–Ω–æ –ª–µ–≥–∫–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å —Å–µ–±–µ —Å–∏—Ç—É–∞—Ü–∏—é, –∫–æ–≥–¥–∞ _–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π_ –¥–æ—Å—Ç—É–ø —Ä–∞–∑–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –æ–±—â–µ–≥–æ —Å—Ç–æ—Ä–∞ –º–æ–∂–µ—Ç –≤—Å–µ —Å–ª–æ–º–∞—Ç—å.

–ü–æ–∫–∞ —É –Ω–∞—Å –æ–¥–∏–Ω –∫–ª–∏–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —ç—Ç–∏–º–∏ —Å—Ç–æ—Ä–∞–º–∏, –≤—Å–µ –æ–∫–µ–π.

```ts
const reset = createEvent();
const run = createEvent();

const waitFx = createEffect(() => {
  return new Promise((resolve) => setTimeout(resolve, 100));
});

const $counter = createStore([]);

$counter.reset(reset);

$counter.on(run, (list, name) => [...list, `manual ${name}`]);

sample({
  clock: run,
  target: waitFx,
});

$counter.on(waitFx.done, (list, {params: name}) => [...list, `fx done ${name}`]);

$counter.watch((i) => console.log('counter', i));
// counter []

run('A');
// counter ["manual A"]

run('B');
// counter ["manual A", "manual B"]

// counter ["manual A", "manual B", "fx done A"]
// counter ["manual A", "manual B", "fx done A", "fx done B"]
```

[Playground](https://share.effector.dev/5oBljPUk)

–î–æ–ø—É—Å—Ç–∏–º `run('A')` –∏ `run('B')` —ç—Ç–æ –≤—ã–∑–æ–≤—ã —Ä–∞–∑–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤. –ó–¥–µ—Å—å –Ω–∞–≥–ª—è–¥–Ω–æ –≤–∏–¥–Ω–æ, —á—Ç–æ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è –æ–±—â–∏–π –º–∞—Å—Å–∏–≤, –∏ –≤ –∏—Ç–æ–≥–µ –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏—é –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—Ç —Å–º–µ—à–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –ï—Å–ª–∏ –±—ã —ç—Ç–æ –±—ã–ª —Å—Ç–æ—Ä —Å –æ–±—ã—á–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏, —Ç–æ –∫–ª–∏–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞–ª–∏ –±—ã —á—É–∂–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –í—ã–∑–æ–≤ –∏–≤–µ–Ω—Ç–∞ `reset` –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏ –Ω–∏–∫–∞–∫ –Ω–µ —Å–ø–∞—Å–µ—Ç —Å–∏—Ç—É–∞—Ü–∏—é:

```ts
run('A');
// counter ["manual A"]

reset();
// counter []

run('B');
// counter ["manual B"]

// counter ["manual B", "fx done A"]
// counter ["manual B", "fx done A", "fx done B"]
```

[Playground](https://share.effector.dev/6bzTKXwA)

–¢–µ–ø–µ—Ä—å –ø—Ä–æ—Å—Ç–æ –ø–æ—Ç–µ—Ä—è–Ω–æ –æ–¥–Ω–æ –∏–∑ –∑–Ω–∞—á–µ–Ω–∏–π –º–∞—Å—Å–∏–≤–∞, —Ç–æ–≥–¥–∞ –∫–∞–∫ `"fx done A"` –≤—Å–µ –µ—â–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω.

## –†–µ—à–µ–Ω–∏–µ ‚Äî Scope

–ê —á—Ç–æ –µ—Å–ª–∏ —Ö—Ä–∞–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç–æ—Ä–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –º–µ—Å—Ç–µ?

```ts
// –ü—Å–µ–≤–¥–æ–∫–æ–¥
const clientA = {stores: new Map()};
const clientB = {stores: new Map()};

// –ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç A –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–≤–æ–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è,
// —á–∏—Ç–∞—Ç—å –∏ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç–æ—Ä–æ–≤ –≤ –æ–±—ä–µ–∫—Ç clientA

run('A');
clientA.stores.set($counter, ['manual A']);
```

–ü—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç fork API. –° –ø–æ–º–æ—â—å—é –≤—ã–∑–æ–≤–∞ `fork()` –º—ã —Å–æ–∑–¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç ‚Äî scope, –≤ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç–æ—Ä–æ–≤. –ò–º–µ–Ω–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ, –≤ SSR –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã React –∏–ª–∏ SolidJS –≤ `Provider`.

```tsx
const scope = fork();

export function Init() {
  return (
    <Provider value={scope}>
      <App />
    </Provider>
  );
}
```

–ß—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤ —Å–∫–æ—É–ø–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `allSettled` –∏–ª–∏ [`useEvent`](https://effector.dev/ru/docs/api/effector-react/useEvent):

```ts
await allSettled(run, {
  scope,
  params: 'A',
});
```

[Playground](https://share.effector.dev/h9rENxUp)

–†–∞–±–æ—Ç–∞–µ—Ç —ç—Ç–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ:
—é–Ω–∏—Ç –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π –≤ `allSettled` –ø–µ—Ä–≤—ã–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –≤ —Å–µ–±–µ —Å—Å—ã–ª–∫—É –Ω–∞ `scope`, —Å—Ç–æ—Ä—ã –ø—Ä–æ—á–∏—Ç–∞—é—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ —ç—Ç–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞, –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –µ—â–µ –Ω–µ –±—ã–ª–æ, –∏—Å–ø–æ–ª—å–∑—É—é—Ç `.defaultState`, –∏ –∑–∞–ø–∏—à—É—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ –≤ scope. –≠—Ñ—Ñ–µ–∫—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç —á—É—Ç—å —Å–ª–æ–∂–Ω–µ–µ, –≤–µ–¥—å –≤ –Ω–∏—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ scope –º–µ–∂–¥—É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ –≤—ã–∑–æ–≤–∞–º–∏, –Ω–æ –∏–¥–µ—è –¥—É–º–∞—é –ø–æ–Ω—è—Ç–Ω–∞.
